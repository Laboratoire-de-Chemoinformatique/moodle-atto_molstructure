YUI.add("moodle-atto_molstructure-button",function(s,t){var o="atto_molstructure",n=M.cfg.wwwroot+"/lib/editor/atto/plugins/molstructure/canvas.html",u="canvas",i={INPUTSUBMIT:"atto_media_urlentrysubmit",HGT:"height: 68vh;",WDT:"width: 48vw;"};s.namespace("M.atto_molstructure").Button=s.Base.create("button",s.M.editor_atto.EditorPlugin,[],{_usercontextid:null,_filename:null,initializer:function(t){this._usercontextid=t.usercontextid,this._filename=(new Date).getTime(),(t=this.get("host").get("filepickeroptions")).image&&t.image.itemid&&(this._itemid=t.image.itemid),this.get("disabled")||this.addButton({icon:"icon",iconComponent:"atto_molstructure",buttonName:"icon",callback:this._displayDialogue,callbackArgs:"icon"})},_displayDialogue:function(t,e){var i=this.getDialogue({headerContent:M.util.get_string("dialogtitle",o),height:"94vh",width:"50vw",focusAfterHide:e});t.preventDefault(),i.after("visibleChange",function(){!1===i.getAttrs().visible&&setTimeout(function(){i.reset()},5)}),t=this._getFormContent(e),i.set("bodyContent",t),document.getElementById(u).src=n,i.centerDialogue(),i.show(),this.markUpdated()},_getFormContent:function(t){var e=s.Handlebars.compile('<iframe src="{{isource}}" id="{{iframeID}}" style="{{CSS.HGT}}{{CSS.WDT}}"><p>{{get_string "iframeprb" component}}</p></iframe><div style="text-align:center"><button class="{{CSS.INPUTSUBMIT}}" id ="{{submitID}}" style="{{selectalign}}">{{get_string "insert" component}}</button></div>'),t=s.Node.create(e({elementid:this.get("host").get("elementid"),CSS:i,component:o,clickedicon:t,isource:n,iframeID:u,submitID:"submit"}));return this._form=t,this._form.one("."+i.INPUTSUBMIT).on("click",this._getImgURL,this),this._form.one("#"+u).on("load",this._changeLangString,this),t},_uploadFile:function(t,e){var i=new XMLHttpRequest,o="datatype=uploadfile",o=(o=(o+="&filedata="+encodeURIComponent(t))+("&requestid="+e)+("&itemid="+this._itemid))+("&sesskey="+M.cfg.sesskey);i.open("POST",M.cfg.wwwroot+"/lib/editor/atto/plugins/molstructure/structurefilelib.php"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Cache-Control","no-cache"),i.setRequestHeader("Content-length",o.length),i.send(o)},_changeLangString:function(t){t.preventDefault(),t=(t=document.querySelector("#"+u)).contentDocument,t.querySelector("#button-size-button").firstChild.data=M.util.get_string("resize",o),t.querySelector("#label_height_input_molstructure").firstChild.data=M.util.get_string("height",o),t.querySelector("#label_width_input_molstructure").firstChild.data=M.util.get_string("width",o)},_getImgURL:function(t){var i,o,n,r,a,e;t.preventDefault(),i=(new Date).getTime()+"-"+Math.round(1e4*Math.random()),o="upfile_"+i+".png",n="",r=this,t=document.querySelector("#"+u).contentDocument.querySelector("#sketcher-viewer-atto"),a=t.toDataURL("image/svg"),t=new s.Promise(function(t){var e;r._uploadFile(a,i),e=M.cfg.wwwroot+"/draftfile.php/"+r._usercontextid+"/user/draft/"+r._itemid+"/"+o,n='<img name="pict" src="'+e+'" alt="ChemDoodle PNG"/>',t()}),e=this.getDialogue({focusAfterHide:null}),t.then(function(){r.editor.focus(),r.get("host").insertContentAtFocusPoint(n),r.markUpdated(),e.hide()},function(){})}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});